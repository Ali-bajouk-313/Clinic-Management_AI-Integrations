@model ClinicManagement.Models.Appointment

<div class="container mt-4">
    <h3>💬 AI Assistant for @Model.Patient.Name (@Model.Patient.Age years)</h3>
    <p class="text-muted">Ask medical suggestions, follow-up ideas, diagnosis questions, etc.</p>

    <div id="chatWindow" class="border rounded p-3 mb-3" style="height: 350px; overflow-y: auto; background:#f8faff;">
    </div>

    <div class="input-group">
        <input id="userMessage" type="text" class="form-control" placeholder="Type your question..." />
        <button class="btn btn-primary" onclick="sendMessage()">Send</button>
    </div>
</div>

<script>
    function sendMessage() {
        var message = document.getElementById("userMessage").value;
        if (!message.trim()) return;

        let container = document.getElementById("chatWindow");
        container.innerHTML += `<div><strong>You:</strong> ${message}</div>`;
        document.getElementById("userMessage").value = "";

        fetch('/Appointment/SendAiMessage?id=@Model.Id', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: `message=${encodeURIComponent(message)}`
        })
        .then(response => response.json())
        .then(data => {
            container.innerHTML += `<div class="text-primary"><strong>AI:</strong> ${data.reply}</div>`;
            container.scrollTop = container.scrollHeight;
        });
    }
</script>
